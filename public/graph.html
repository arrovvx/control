<!DOCTYPE HTML>
<html>

<head>
	<script src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>
	<script type="text/javascript">
		
	function WSTest(){
	
		//number of datapoints to be displayed
		var dps = [], 			//data points value array
			xVal = 0,		  	//the x value axis of the chart
			dataLength = 100; 	//number of points visible on chart


		//create the chart to be displayed using canvasJS
		var chart = new CanvasJS.Chart("chartContainer",{
			title :{
				text: "Master Fred Having sex real time"
			},			
			data: [{
				type: "line",
				dataPoints: dps 
			}]
		});
		
		//function called to update the chart
		var updateChart = function (yVal) {
		
			dps.push({
				x: xVal,
				y: yVal
			});
			xVal++;
			
			if (dps.length > dataLength)
				dps.shift();
			
			chart.render();		
		};
			
		//check if websocket is supported
		if ("WebSocket" in window) {
		

			var wsPort = 7778;
			//create connection
			var ws = new WebSocket("ws://localhost:" + wsPort + "/");

			ws.onopen = function(){
			  ws.send("Notice me senpai");
			};

			ws.onmessage = function (evt) { 
			  var received_msg = JSON.parse(evt.data);
			  var a = parseFloat(received_msg.message);
			  updateChart(a);
			  
			  //var displaybox = document.getElementById("displaybox");
			  //displaybox.innerHTML += "<div class=\"their-text\">"+a+"\n"+"</div>";
			  
			};

			ws.onclose = function() { 
			  // websocket is closed.
			  alert("Connection is closed..."); 
			};
		} else {
		   alert("WebSocket NOT supported");
		}
	}
	
	
	
	
	</script>
</head>
<body>
	<div id="chartContainer" style="height: 300px; width:50%;">
	</div>
	
	<div>
		<a href="javascript:WSTest()">Run WebSocket</a>
	</div>
	   <div id="displaybox" class="chatDisplay"></div>
</body>
</html>
